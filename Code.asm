ORG 000H
CLK BIT P3.5
DL_LOAD BIT P3.6
CHOT_DL BIT P3.7
DTOUT EQU P2

MOV	TMOD, #20H
MOV	TH1, #0FDH
MOV	SCON, #50H
SETB	TR1

WAIT:   JB P0.4, WAIT

AGAIN:
      CLR	RI
REPEAT:
      JNB	RI, REPEAT
      MOV	A, SBUF
      CJNE	A, #'A', CHECKNEXT
      LJMP PHAISANGTRAI
      
CHECKNEXT:
      CJNE	A, #'B', CHECKNEXT1
      LJMP TRAISANGPHAI

 CHECKNEXT1:
      CJNE	A, #'C', AGAIN
      LJMP SHOW

PHAISANGTRAI:
MOV A, #0
MOV DPTR,#ARR
COUNT: 
      MOV R0,#3
LOOP:
      LCALL DISPLAY
      DJNZ R0,LOOP
      INC DPTR
      INC A
      CJNE A,#175, COUNT
      LJMP PHAISANGTRAI
DISPLAY:
      PUSH ACC
      PUSH 00H
      MOV R0,#00H 
      SETB DL_LOAD
      SCAN:
	    MOV A,R0
	    MOVC A,@A+DPTR 
	    MOV DTOUT,A
	    CLR CLK
	    SETB CLK
	    CLR CHOT_DL
	    SETB CHOT_DL
	    LCALL DELAY
	    MOV DTOUT,#0FFH
	    CLR DL_LOAD
	    INC R0
	    CJNE R0,#32,SCAN
      POP 00H
      POP ACC
RET
         
TRAISANGPHAI:
MOV A, #0
MOV DPTR,#ARR1
COUNT_1: 
      MOV R0,#3
LOOP_1:
      LCALL DISPLAY_1
      DJNZ R0,LOOP_1
      INC DPTR
      INC A 
      CJNE A,#160,COUNT_1
      LJMP TRAISANGPHAI
DISPLAY_1:
      PUSH ACC
      PUSH 00H
      MOV R0,#32H 
      SETB DL_LOAD
      SCAN_1:
	    MOV A,R0
	    MOVC A,@A+DPTR 
	    MOV DTOUT,A
	    CLR CLK
	    SETB CLK
	    CLR CHOT_DL
	    SETB CHOT_DL
	    LCALL DELAY
	    MOV DTOUT,#0FFH
	    CLR DL_LOAD
	    DJNZ R0,SCAN_1
      POP 00H
      POP ACC
RET

SHOW:
MOV A, #0
MOV DPTR,#ARR2
COUNT_2: 
      MOV R0,#3
LOOP_2:
      LCALL DISPLAY_2
      DJNZ R0,LOOP_2
      INC A
      CJNE A,#175, COUNT_2
      LJMP SHOW
DISPLAY_2:
      PUSH ACC
      PUSH 00H
      MOV R0,#00H 
      SETB DL_LOAD
      SCAN_2:
	    MOV A,R0
	    MOVC A,@A+DPTR 
	    MOV DTOUT,A
	    CLR CLK
	    SETB CLK
	    CLR CHOT_DL
	    SETB CHOT_DL
	    LCALL DELAY
	    MOV DTOUT,#0FFH
	    CLR DL_LOAD
	    INC R0
	    CJNE R0,#32,SCAN_2
      POP 00H
      POP ACC
RET

DELAY:
MOV R7,#2
KT1: MOV R6,#247
KT2: DJNZ R6,KT2
DJNZ R7,KT1
RET

ARR:
DB 0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH, 0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH, 0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH, 0FFH,0FFH
DB 0FFH,01H,01H,7DH,7DH,01H,83H,0FFH, 0FFH,01H,01H,0EFH,0EFH,01H,01H, 0FFH,0FFH,0FFH    ;DH
DB 0FFH,83H,01H,7DH,39H,0BBH,0FFH, 0FFH,01H,01H,0F3H,0E7H,0CFH,01H,01H, 0FFH,0F9H,0FDH,01H,01H,0FDH,0F9H,0FFH, 0FFH,0F9H,0FDH,01H,01H,0FDH,0F9H,0FFH		;CNTT
DB 0FFH,0E7H,0E7H,0E7H,0E7H,0FFH
DB 0FFH,01H,01H,0C7H,93H,39H,7DH,0FFH, 0FFH,0F9H,0FDH,01H,01H,0FDH,0F9H,0FFH, 0FFH,01H,01H,0F3H,0E7H,0F3H,01H,01H, 0FFH,0F9H,0FDH,01H,01H,0FDH,0F9H,0FFH
DB 0FFH,0E7H,0E7H,0E7H,0E7H,0FFH
DB 0FFH,0C1H,81H,3FH,3FH,81H,0C1H,0FFH, 0FFH,39H,11H,0C7H,0EFH,0C7H,11H,39H, 0FFH,01H,01H,7FH,7FH,7FH,7FH,0FFH, 0FFH,0FFH,0FFH, 0FFH,0C1H,81H,3FH,3FH,81H,0C1H,0FFH, 0FFH,01H,01H,7DH,7DH,01H,83H,0FFH, 0FFH,01H,01H,0C7H,93H,39H,7DH,0FFH
DB 0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH, 0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH, 0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH, 0FFH,0FFH

ARR1:
DB 0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH, 0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH, 0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH, 0FFH,0FFH
DB 0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH, 0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH, 0FFH,9BH,19H,5DH,7DH,01H,83H,0FFH,  01H,01H,0CFH,0E7H,0F3H,01H,01H,0FFH, 0FFH,03H,01H,0EDH,01H,03H,0FFH, 0FFH,083H,01H,7DH,7DH,01H,01H,0FFH, 0FFH,0FFH,0FFH
DB 0FFH,0BBH,39H,7DH,7DH,01H,83H,0FFH, 0FFH,83H,01H,7DH,7DH,01H,83H,0FFH, 0FFH,01H,01H,7FH,7FH,01H,81H,0FFH, 0FFH,43H,01H,9DH,0BDH,81H,0C3H,0FFH
DB 0FFH,0E7H,0E7H,0E7H,0E7H,0FFH
DB 01H,01H,0CFH,0E7H,0F3H,01H,01H,0FFH, 0FFH,03H,01H,0EDH,01H,03H,0FFH, 0FFH,0F9H,0FDH,01H,01H,0FDH,0F9H,0FFH,  0FFH,0FFH,0FFH 
DB 0FFH,01H,01H,0EFH,0EFH,01H,01H,0FFH, 01H,01H,0CFH,0E7H,0F3H,01H,01H,0FFH, 0FFH,0FFH,7DH,01H,01H,7DH,0FFH,0FFH, 01H,01H,0F3H,0EFH,0F3H,01H,01H,0FFH
DB 0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH, 0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH, 0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH, 0FFH,0FFH

ARR2:
DB 0FFH,0FFH,0E7H,0E7H,0E7H,0E7H,0FFH,0FFH,  0FFH,83H,01H,7DH,5DH,19H,9BH,0FFH,
0FFH,83H,01H,7DH,5DH,19H,9BH,0FFH,  0FFH,0FFH,0E7H,0E7H,0E7H,0E7H,0FFH,
0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH
END
